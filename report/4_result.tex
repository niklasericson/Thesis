% !TEX root = main.tex
\chapter{Simulation Results}\label{cha:result}
This section describes the simulation results considering performance, robustness and stability with respect to the different control approaches. All approaches will first be benchmarked with the present control approach and presented individually in the following subsections. Comparison tables outlining the performance and the robustness of each controller will be presented in the end of this chapter.

\section{Benchmarking Tests}
For the comparison with the present control approach, all evaluated controllers were discretized with a sampling frequency of 2kHz. The normalized system in \eqref{eq:tf} was used to model the rotational stage linear dynamics. The nonlinear dynamics, creep and hysteresis, were neglected in the simulations, assuming perfect inverse hysteresis cancellation and a sufficient closed loop to compensate for the creep effect. All simulations were performed in Matlab and Simulink. The \abbrMRACPE and the \abbrIRC have been evaluated with respect to robustness to model errors, disturbance rejection, closed loop bandwidth and response to step and periodical input, all listed below.

\begin{itemize}
\item {\bf Step and periodical tracking} - A step and a periodical input is applied to the input to benchmark the tracking capability of the controller.
\item {\bf Disturbance rejection} - Impulses are added to the input and output signal of the system to benchmark how sensitive the system is to system disturbances.
\item {\bf Robustness to model errors} - The robustness to model errors is characterized by changing the plant model but keeping the model in the controller constant.
\end{itemize}

The \abbrIMP, the \abbrFDC and the \abbrRFDC have been evaluated with respect to cancellation effectiveness and robustness to model errors, as listed below.

\begin{itemize}
\item {\bf Cancellation performance} -  Sinusoidal signals or acquired noise from the lab is added as disturbance to test the cancellation performance.
\item {\bf Robustness to model errors} - The robustness to model errors is characterized by changing the plant model of the system but keeping the model in the controller constant.
\end{itemize}

The prospective challenges, described in \ref{sec:prospectiveChallanges} shall be kept in mind while reading the results. Since the required ramp rates are relatively low, the disturbance rejection and the robustness to model errors are more of interest when evaluating each method.

\section{Linear Dynamics Characterization}
The linear dynamics of the rotational stage change due to a number of physical properties of the system, such as the current yaw-position, the linear axis position and speed and if the system is in contact with the end-switches. This phenomenon were characterized in a number of tests on a similar rotational stage as the one used for the simulations in this thesis. Figure~\ref{fig:different_angles} shows a comparison of the identified model when the linear axis is in its inner position and the rotational head has rotated -10 mrad (0 V), 0 mrad (3.25 V) and 10 mrad (6.5 V). It shows that the system changes its first resonance peak as much as 15.3 Hz.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:different_angles}Different rotational head positions]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 0.8cm 1cm, clip=true]{fig/matlab/modelcomparison_diffvolt2.eps}}
  \qquad
  \subfloat[][\label{fig:different_lin_pos}Different linear axis positions]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 0.8cm 1cm, clip=true]{fig/matlab/modelcomparison2.eps}}
  \caption{\label{fig:different_lin_angle} Identified models with different rotational positions (linear axis in 54.24 mm) is shown in (a) and with different linear axis positions (rotational position corresponding to 3.25 V) is shown in (b).}
\end{figure}

Figure~\ref{fig:different_lin_pos} shows a comparison of the identified model when the rotational head is in 0 mrad (3.25 V) and the linear axis position is in 1, 20, 40 and 57 mm. The identified system are almost the same for the first 3 positions, but it changes drastically when the linear axis is 1 mm from the switches i.e. in 57 mm.

Since the rotational stage controller needs to maintain the required tracking error even when the linear axis is moving, the disturbance during linear movement must be considered. Figure~\ref{fig:dist_diff_speed} shows the open loop response when the linear axis is moving. This figure shows how the operating speed of the stepping motor influences the spectrum of the angle with its different harmonics.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:dist_diff_speed_overview}Open loop response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 0.8cm 0cm, clip=true]{fig/matlab/differentspeeds2.eps}}
  \qquad
  \subfloat[][\label{fig:dist_diff_speed_zoomin}Zoom-in]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 0.8cm 0cm, clip=true]{fig/matlab/differentspeeds_Zoomin2.eps}}
  \caption{\label{fig:dist_diff_speed} \abbrFFT of the yaw angle in open loop with the rotational head in 0 mrad (3.25 V). The whole spectrum is shown in (a) while a zoom-in is shown in (b). One can see how the induced harmonics are multiples of the stepping speeds.}
\end{figure}

\newpage
\FloatBarrier
\section{Model Reference Adaptive Control}
Even though a high order model of the rotational stage exists as presented in \eqref{eq:tf}, a second order model approximating the higher order system was used in the adaptive control laws to keep the computational burden low. The discretized reference model can be seen in \eqref{eq:sys_gm} and all parameters and tuning variables are summarized in Table~\ref{tab:adaptive_param}. The controller was tuned to be robust to input disturbances and model changes. The set of parameter presented in Table~\ref{tab:adaptive_param} is not an optimal set but a decent set of parameters that maintains stability for step sizes below 20 mrad.

\begin{equation}
  \label{eq:sys_gm}
  G_m(z) = \frac{7.9z + 6.7}{1313z^{2} - 2095z + 796.4}
\end{equation}

\begin{table}[h!]
  \centering
  \begin{tabular}{| l | l |}
    \hline
    Parameter & Value \\ \hline
    $T_s$ & $5 \times 10^{-4}$ \\
    $\alpha_0$ & $5.7 \times 10^{4}$ \\
    $\alpha_1$ & $7.2$ \\
    $\beta_0$ & $7.5 \times 10^{7}$ \\
    $a_0$ & $5.7 \times 10^{4}$ \\
    $a_1$ & $1 \times 10^{3}$ \\
    $b_0$ & $7.5 \times 10^{7}$ \\
    $\eta_0$ & $3 \times 10^{-2}$ \\
    $\eta_1$ & $1 \times 10^{-1}$ \\
    $\eta_2$ & $1 \times 10^{-10}$ \\
    $\eta_3$ & $1 \times 10^{-17}$ \\
    $\epsilon$ & $1 \times 10^{-8}$ \\
    $Q$ & $diag(1 \times 10^{10}, 1 \times 10^{-3})$\\
    \hline
  \end{tabular}
  \caption{\label{tab:adaptive_param} Parameters of the system model and the tuned adaptive controller.}
\end{table}

Figure~\ref{fig:step_adaptive} shows the step response to different step sizes. Here it is clear that the system becomes unstable if the step size $\geq$ 26 mrad. Note that all tests were produced with initial values $k_i = 0$.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/stepresponse.eps}
  \caption{\label{fig:step_adaptive} Step responses to step sizes of 10, 15, 20 and 26 mrad. The largest step illustrates a nonlinear phenomenon i.e. the controller stability depends on the step size.}
\end{figure}

The adaptation process of the control parameters $k_i$, for a step response resulting from a 20 mrad step, can be seen in Figure~\ref{fig:adapt_process}. All of the coefficients have converged within 1 s.

\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{fig/matlab/k.eps}
  \caption{\label{fig:adapt_process} Adaptation process of control parameters $k_i$ with a 20 mrad step.}
\end{figure}

\FloatBarrier
To illustrate the adaptation process better, a periodic response is depicted in Figure~\ref{fig:periodic_resp} which shows that after the adaptation process is finished the controller performs better for the second and third period. One can see that the adaptation process is slower for the periodic response corresponding to a lower step. Hence, the lower the step, the longer the adaptation time. The present controller tracks the periodic input well independently of the step size.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/periodicresponse.eps}
  \caption{\label{fig:periodic_resp} Periodical input response of the adaptive and the present controller with amplitudes of 10, 15, 20 mrad.}
\end{figure}

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/trackingerror.eps}
  \caption{\label{fig:adapt_trackingerror} Tracking error (difference between the reference and output signal) of the periodical input response with an  amplitude of 20 mrad.}
\end{figure}

The tracking error corresponding to the \emph{Adaptive 20mrad} and \emph{Present 20mrad} in Figure~\ref{fig:periodic_resp} can be seen in Figure~\ref{fig:adapt_trackingerror}. The adaptive controller performs better than the present controller after the adaptation process has finished.

A periodic response with model parameter drift is presented in Figure~\ref{fig:modeldrift}. It shows how the adaptive controller manages to adapt to changes in the plant, while the present controller fails to do so, resulting in an unstable system. The change of the model was performed over 2 seconds, resulting in a movement of the first resonance peak, from 38 Hz to 66 Hz in frequency and from 30.1 dB to 23.5 dB in magnitude.
\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:modeldriftresponse}Periodic response with model parameter drift.]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/driftofmodelparameterover2s.eps}}
  \qquad
  \subfloat[][\label{fig:modeldriftbode}Original model (G) and the resulting model after drift ($G_{mod}$).]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 0.7cm 0cm, clip=true]{fig/matlab/bode_drift_pole.eps}}
  \caption{\label{fig:modeldrift} Periodical input response with induced model errors for the adaptive and the present controller. The model error is increased linearly from $t=$ 7 s to $t=$ 9 s. The resulting responses are shown in (a) with the induced model change in (b).}
\end{figure}

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:modelerrorresponse}Periodic response with model parameter drift.]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/modelerrorperiodic.eps}}
  \qquad
  \subfloat[][\label{fig:modelerrorbode}Original model (G) and the resulting model after drift ($G_{mod}$).]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 0.7cm 0cm, clip=true]{fig/matlab/bode_modelerror_pole.eps}}
  \caption{\label{fig:modelerror}Periodical input response with induced model errors for the adaptive and the present controller. The model error is increased linearly from $t=$ 5 s to $t=$ 7 s. The resulting responses are shown in (a) with the model change in (b).}
\end{figure}

In the case in Figure~\ref{fig:modelerror} the resonance peak is only moved by 17 Hz and the present controller is sufficient to suppresses the disturbance. It even does it more efficiently than the adaptive controller. Even though the adaptive controller is slower than the present controller it still achieves a smaller tracking error after the adaption process is over, see Figure~\ref{fig:modelerror_trackingerror}. Note that the change in the model is equivalent to the change between 0V and 6.5V presented in Figure~\ref{fig:different_angles}.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/modelerrorperiodic_trackingerror.eps}
  \caption{\label{fig:modelerror_trackingerror} Tracking error of the periodic response with model errors increased linearly from $t=$ 5 s to $t=$ 7 s shown in Figure~\ref{fig:modelerror}.}
\end{figure}

\FloatBarrier
Figure~\ref{fig:distrejection} and \ref{fig:distmeasrejection} show the disturbance rejection capability to a disturbance applied on the input and output of the system. In Figure~\ref{fig:distrejection} a small impulse was added to the input. The adaptive controller performed worse than the present controller, attenuating the highest peak of the impulse by 62\% less than the present. The settling time was also approximately 3 times longer for the adaptive controller. In Figure~\ref{fig:distmeasrejection} the impulse was instead added to the output of the system. Even in this case the present controller was superior, attenuating the highest peak of the impulse by 43\%  more than the adaptive controller.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:dist}Step response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/distrejection.eps}}
  \qquad
  \subfloat[][\label{fig:distzoom}Zoom-in on disturbance]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/distrejection_zoom.eps}}
  \caption{\label{fig:distrejection} Step response with a disturbance impulse (amplitude of 5.1 mV) added to the input of the system at $t=$ 3 s. The whole step response is shown in (a) with a zoom-in on the disturbance in (b).}
\end{figure}
\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:distmeas}Step response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/distrejection_meas.eps}}
  \qquad
  \subfloat[][\label{fig:distmeaszoom}Zoom-in on disturbance]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/distrejection_meas_zoom.eps}}
  \caption{\label{fig:distmeasrejection} Step response with a disturbance impulse (amplitude of 5.1 mrad) added to the output of the system at $t=$ 3 s. The whole step response is shown in (a) with a zoom-in on the disturbance in (b).}
\end{figure}

\newpage~\newpage
\FloatBarrier
\section{Integral Resonance Control}
The \abbrIRC's design procedure presented in \ref{sec:irc} was carried out in continuous time, but each block in the scheme was individually discretized for the sake of comparison with the present controller. The identified discrete system in \eqref{eq:tf} was converted to continuous time with the zero-order hold method in Matlab resulting in a continuous time transfer function with six zeros and seven poles. Since the system has a relative degree of one, the negative feedforward will introduce one additional zero. As seen in the pole-zero plot comparison in Figure~\ref{fig:negfeedpzmap}, a feedforward of $D_f=-1.2$ was sufficient to introduce one zero and place it and its complex conjugate below the first resonance frequency. This and the zero-pole interlacing for the higher order modes can be seen in Figure~\ref{fig:pzafter}, where the zoom-in shows the complex conjugate zeros below the first resonance mode.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:pzbefore}Original system]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 1cm, clip=true]{fig/matlab/pzbefore.eps}}
  \qquad
  \subfloat[][\label{fig:pzafter}With feedforward]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 1cm, clip=true]{fig/matlab/pzafter.eps}}
  \caption{\label{fig:negfeedpzmap} Comparison of pole-zero plot before and after the addition of the negative feedforward. After adding the feedforward to the system, which poles and zeros are shown in (a), the zeros and poles are interlacing as seen in (b).}
\end{figure}

The corresponding Bode plot can be seen in Figure~\ref{fig:bodeafterfeedf}, showing the complex conjugate pair of zeros as a dip before the first resonance peak.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/bodeafterfeedf.eps}
  \caption{\label{fig:bodeafterfeedf} Bode plot of the continues time system before and after the addition of the negative feedforward.}
\end{figure}

The integral controller $C(s)=-k/s$ was added according to Section~\ref{sec:irc} and a gain of $k=314$ was found to maximize the damping, by using the root locus technique.
The open and closed loop system of the \abbrIRC damping loop depicted in Figure~\ref{fig:irc} is shown in Figure~\ref{fig:bodedamped}. It is clear that the integral controller damps out the first resonance peak efficiently in closed loop.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/bodedamped2}
  \caption{\label{fig:bodedamped} Bode plot of the discretized open and closed loop of the \abbrIRC damping loop i.e. the inner loop of the total control loop depicted in Figure~\ref{fig:irc}.}
\end{figure}

\FloatBarrier
Finally, the damped system was enclosed in an outer loop with a second controller $C_1(z)$ for reference tracking capability. $C_1(z)$ was designed to be robust to model errors i.e. keep the sensitivity function stated in \eqref{eq:discrsys1} low for the frequencies that the model changes with. It was also designed to attenuate higher order resonances by including a notch filter. $C_1(z)$ was designed in Matlab's SISO-Tool and is presented in \eqref{eq:C_1}.

\begin{equation}
  \label{eq:C_1}
  C_1(z) = \frac{-13.54 z^5 + 40.92 z^4 - 57.47 z^3 + 55.89 z^2 - 35.87 z + 10.05}{z^5 - 1.65 z^4 + 0.80 z^3 - 0.16 z^2 + 0.014 z - 0.00042} \\
\end{equation}

The resulting closed loop system and the sensitivity function is shown in Figure~\ref{fig:irc_totalclosed} and \ref{fig:sensitivity_irc}, respectively. The plots show that the use of the \abbrIRC has increased the closed loop bandwidth from 11 Hz to 73 Hz. The \abbrIRC's sensitivity function also shows that the \abbrIRC scheme attenuates disturbances better in the low frequency range and in the region within 24-64 Hz. The sensitivity function is written in Section~\ref{sec:irc}.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/totalclosedloop.eps}
  \caption{\label{fig:irc_totalclosed} Bode plot of the discretized closed loop system of the outer control loop for the \abbrIRC depicted in Figure~\ref{fig:irc_int} and the present closed loop system.}
\end{figure}

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/sensitivity_irc.eps}
  \caption{\label{fig:sensitivity_irc}Sensitivity function of the \abbrIRC and the present control approach.}
\end{figure}

%\FloatBarrier
The \abbrIRC's tracking performance is shown in Figure~\ref{fig:irc_tracking} where the tracking error has been considerably reduced owing to the high bandwidth of the \abbrIRC.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:irc_periodic}Periodic Response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/irc_periodic.eps}}
  \qquad
  \subfloat[][\label{fig:irc_tracking_error}Tracking error]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/irctrackingerror.eps}}
  \caption{\label{fig:irc_tracking} Periodical input response of the \abbrIRC and the present controller shown in (a) with the tracking error shown in (b).}
\end{figure}

The robustness test performed for the adaptive controller was done for the \abbrIRC controller accordingly. Figure~\ref{fig:irc_dist_model} shows the periodic response and its tracking error when the model is changed linearly according to Figure~\ref{fig:modelerrorbode}. The \abbrIRC handles the model drift better than the present controller.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:irc_dist_model}Periodic response with model parameter drift.]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/irc_periodic_drift.eps}}
  \qquad
  \subfloat[][\label{fig:irc_dist_model_drift}Tracking error with model parameter drift.]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/irc_periodic_trackingerror.eps}}
  \caption{\label{fig:irc_dist} Periodical input response with induced model errors for the \abbrIRC and the present controller. The model error is increased linearly from $t=$ 5 s to $t=$ 7 s. The resulting responses are shown in (a) with the tracking error is shown in (b).}
\end{figure}

\FloatBarrier
The capability of rejecting disturbances on the input signal is shown in Figure~\ref{fig:irc_dist_input}. As seen in the zoom-in, the \abbrIRC is slightly more damped but has a high frequency ringing in 448Hz, the same frequency as the model's second resonance peak. This ringing is also showing in the present controller but is less dominant.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:irc_dist_input_step}Step response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/irc_dist_input.eps}}
  \qquad
  \subfloat[][\label{fig:irc_dist_input_zoom}Zoom-in on disturbance]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/irc_dist_input_zoom.eps}}
  \caption{\label{fig:irc_dist_input} Step response with a disturbance impulse (amplitude of 5.1 mV) added to the input of the system at $t=$ 3 s. The whole step response is shown in (a) with a zoom-in on the disturbance in (b).}
\end{figure}

The capability of rejecting disturbances on the output signal is shown in Figure~\ref{fig:irc_dist_output}. Since the impulse is added directly on the output the step response peaks accordingly at $t=$ 3 s. It is hard to tell from Figure~\ref{fig:irc_dist_output_zoom}, but the peak is visible for both of the control approaches. After the peak, the methods perform similarly but with a higher damping of the low frequency mode for the \abbrIRC oscillations as shown in the zoom-in.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:irc_dist_output_step}Step response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/distrej_meas.eps}}
  \qquad
  \subfloat[][\label{fig:irc_dist_output_zoom}Zoom-in on disturbance]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/distrej_meas_zoom.eps}}
  \caption{\label{fig:irc_dist_output} Step response with a disturbance impulse (amplitude of 5.1 mrad) added to the output of the system at $t=$ 3 s. The whole step response is shown in (a) with a zoom-in on the disturbance in (b).}
\end{figure}
\FloatBarrier
To further verify the capability of handling disturbances with various frequencies, a white noise was applied to the input and output of the system, illustrated in Figure~\ref{fig:irc_int} as $d_i$ and $d_o$, respectively. The \abbrFFT was then performed on the output ($y$) to verify the disturbance rejection for all frequencies, and the result is presented in Figure~\ref{fig:fft_in} and Figure~\ref{fig:fft_out}.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/whitenoiseoutput.eps}
  \caption{\label{fig:fft_in} The \abbrFFT of the output signal from the \abbrIRC and the present closed loop system when applying white noise to the output of the system.}
\end{figure}

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/whitenoiseinput.eps}
  \caption{\label{fig:fft_out} The \abbrFFT of the output signal from the \abbrIRC and the present closed loop system when applying white noise to the input of the system.}
\end{figure}


The standard deviations of the output signal with a disturbance with $\sigma$ = \unit{1.41\micro\radian} added to both the output and input for the \abbrIRC and the present approach are summarized in Table~\ref{tab:std}.

\begin{table}[h!]
  \centering
  \begin{tabular}{| l | l | l |}
    \hline
    Disturbance applied to: & input & output \\ \hline
      $\frac{\sigma_{IRC}}{\sigma_{Present}}$ [\%] & $66$  & $ 102$ \\
    \hline
  \end{tabular}
  \caption{\label{tab:std} Standard deviations of the output signal with white noise added as a disturbance on the output of the system}
\end{table}

\newpage
\FloatBarrier
\section{Harmonic Cancellation}
All harmonic cancellation methods were implemented and benchmarked with realistic disturbance data acquired with the lab setup described in Section~\ref{sec:setup}. The disturbance data was acquired in open loop during a linear axis movement around the operating point of the linear axis, which is 3 mm out from the inner position with respect to the beam. Each cancellation method was benchmarked individually with respect to cancellation performance and robustness to model errors.

\subsection{Feedforward Disturbance Cancellation}\label{sec:hc}
The \abbrFDC methodology cancels out known disturbances coming from a linear axis movement. The stepping signal sent to the motor is known at all time and is therefore suitable to be used as input signal ($d_0$ in Figure~\ref{fig:ffdist}) to the disturbance model. Data was acquired in open loop during a linear axis movement corresponding to 50 steps of the stepping motor. The movement was performed with four different speeds (1, 2, 5 and 10 steps/s) around the operating point. The chosen linear speeds were relatively low compared to normal operation, but used for the purpose of getting enough time between each step in order for the response to have sufficient time to settle. Figure~\ref{fig:stepinout} shows the yaw angle response from one motor step and the impulse used for the identification of the disturbance model.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:stepin}Impulse used as input signal]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/ff_impulse.eps}}
  \qquad
  \subfloat[][\label{fig:stepout}Mean of impulse responses]{
  \includegraphics[ width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/yaw_angle_mean_1_step_s.eps}}
  \caption{\label{fig:stepinout} Input signal (a) and step response (b) used for modeling the disturbance. The step response was calculated by taking the mean of 50 time-synchronized acquired step responses at a movement of 1 step/s.}
\end{figure}

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\abbrFFT at 0 V ]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 0.9cm 0.8cm, clip=true]{fig/matlab/fft_mean_in_out_0V.eps}}
  \qquad
  \subfloat[][\abbrFFT at 3.25 V]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 0.9cm 0.8cm, clip=true]{fig/matlab/fft_mean_in_out_3V.eps}}
  \caption{\label{fig:fft0_3} Disturbance representation in the frequency domain. The plot shows the calculated \abbrFFT at two different positions, 0 V $\sim -$10 mrad (a) and 3.25 V $\sim$ 0 mrad (b) for the speeds 1,2,5 and 10 steps/s.}
\end{figure}

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:fft_6_5}\abbrFFT at 6.5 V]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/fft_mean_in_out_6_5V.eps}}
  \qquad
  \subfloat[][\label{fig:distmodelfit}Identified model]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/model_fit_1step_s.eps}}
  \caption{\label{fig:fft_6_5_modelfit} Disturbance representation in the frequency domain with the identified model. The calculated \abbrFFT at 6.5 V $\sim$ 10 mrad is shown in (a) and the identified model to the mean of the data in (a) is shown in (b).}
\end{figure}

In a real implementation, the stepping voltage would be used to form a pulse train containing impulses similar to the one showed in Figure~\ref{fig:stepin}.

The empirical estimate of the disturbance model $P_d$ is obtained by dividing the \abbrFFT of (b) with the \abbrFFT of (a) in Figure~\ref{fig:stepinout}. The resulting empirical estimate is shown for different positions and speeds in Figure~\ref{fig:fft0_3} and \ref{fig:fft_6_5} . As seen in the figures, there are distinct peaks at around 220, 445, 670 and 890 Hz. The amplitude and the frequency of the resonance peaks are varying with the step rate as seen in Figure~\ref{fig:3vzoomin}.

Figure~\ref{fig:fft_6_5_modelfit} shows the identified model for the data acquired at 6.5 V and 1 step/s. This data was chosen due to its homogeneous shape at different step rates. In order to sufficiently model four resonances, a 19 zeros and 20 poles transfer function was needed. The model was used in the simulations but has to be reduced for a reasonable implementation in terms of computational efficiency. The identification was performed using Matlab System Identification Toolbox with a selected frequency focus from 30-1000 Hz, to avoid modeling low frequency components below the first resonance peak. The identified disturbance model $P_d(z)$ is presented in its final form in Appendix~\ref{app:fdc}. $K_f(z)$ was calculated as $K_f(z)=P_d(z)/G(z)$.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/fft_mean_in_out_3V_zoomin.eps}
  \caption{\label{fig:3vzoomin} Zoom-in on the first resonance peak of the \abbrFFT performed on the data acquired at 3.25 V $\sim$ 0 mrad. The top peak of the resonance is varying with the step rate i.e. 5 step/s $\sim$ 225 Hz and 10 step/s $\sim$ 220 Hz.}
\end{figure}
\FloatBarrier

The disturbance model was benchmarked with two slightly different disturbances, first with the mean shown in Figure~\ref{fig:stepout} (the signal used in the identification) and then with a signal picked out as one period from the original acquired data. The cancellation performance at 6.5 V and 1 step/s can be seen in Figure~\ref{fig:benchmark_dist}. The \abbrFDC manages to mitigate the disturbance on the yaw angle by almost half of the amplitude with the mean fed as disturbance. With the more realistic disturbance in (b) the disturbance cancellation is however less effective.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][Mean as disturbance]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/cancellation_1_step_s.eps}}
  \qquad
  \subfloat[][Original acquired signal as disturbance ]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/cancellation_1_step_s_real_dist.eps}}
  \caption{\label{fig:benchmark_dist} Feedforward disturbance cancellation with the mean of the acquired response added as disturbance (a) and one period of the acquired response added as disturbance (b). The disturbance cancellation is less effective with a slightly different disturbance.}
\end{figure}
\FloatBarrier
To illustrate the model efficiency with different step rates, a benchmarking test with the same identified model as above was performed with the mean corresponding to each of the stepping rates added as disturbance. The outcome is presented in Table~\ref{tab:std_diff_speed} as the standard deviation of the yaw angle, showing that a single model is sufficient to reduce the disturbance level for several other stepping rates as well.
\begin{table}[h!]
  \centering
  \begin{tabular}{| l | l | l | l | l |}
    \hline
      Speed & 1 step/s & 2 step/s & 5 step/s & 10 step/s\\ \hline
      $\sigma_{Present}$ & 2.15 & 2.23 & 3.90 & 3.76\\
      $\sigma_{Present + dist.FF.}$ & 1.19 & 2.04 & 2.06 & 2.59\\
    \hline
  \end{tabular}
  \caption{\label{tab:std_diff_speed} Standard deviations of the output with and without disturbance feedforward for the different speeds with the mean of the acquired response corresponding to each speed added as disturbance. The model used in the disturbance feedforward was identified from the 6.5 V and 1 step/s data.}
\end{table}

\FloatBarrier
To benchmark how well the cancellation works with model errors, a simulation with four different perturbed models was performed with the disturbance feedforward based on the same models as before. The models including the original system itself is shown in Figure~\ref{fig:hc_me_bode}, where the first resonance peak has been perturbed. This models the previously identified behavior when the rotational stage rotates from -10 to 10 mrad.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/bode_rfdc_modelerror.eps}
  \caption{\label{fig:hc_me_bode} Bode plot of the five different models used for the simulation of model error, including the original model G - 38.1Hz.}
\end{figure}

The \abbrFFT of the simulation results can be seen in Figure~\ref{fig:hc_model_error1} where the attenuation of the major disturbance component is shown. The simulations indicate that the cancellation is still efficient even with model errors being present. The original controller and system without disturbance cancellation is included in the plots as a reference and is named \emph{G - 38.1 Hz}. Figure~\ref{fig:hc_model_error2} illustrates the impact that the model errors have on the attenuation of some other resonances present in the system. Here 92.3 Hz is chosen as an example to illustrate that the cancellation with model errors can lead to amplification at some frequencies.


\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:hc_model_error1} Attenuation of major frequency]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/hc_model_error.eps}}
  \qquad
  \subfloat[][\label{fig:hc_model_error2} Impact on 92.3 Hz component]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/hc_model_error92.eps}}
  \caption{\label{fig:hc_model_error} Disturbance cancellation effectiveness with model errors. The attenuation of the major frequency is shown in (a) while the attenuation of the 92.3 Hz component is shown in (b).}
\end{figure}

\FloatBarrier
\subsection{Cancellation with Internal Model Principle}
The implementation of the \abbrIMP cancellation method was based on the theory in Section~\ref{subsec:distimp}. A pure sinusoidal disturbance was used as the generating polynomial $\Gamma(s) = s^2 + \omega^2$, where the angular frequency to reject was chosen to $\omega = 100\pi$ rad/s. This choice of polynomial gives full attenuation in the selected frequency but impacts on the attenuation of system's first resonance peak at 38.1 Hz. Hence, in order to get sufficient attenuation at both of the frequencies, a bit of damping was added to the polynomial. The normalized continuous time transfer function that was discretized and added to the system is presented below.

\begin{equation}
  C_{imp}(s) = \frac{(100\pi)^2}{s^2 + s + (100\pi)^2}
\end{equation}

The controller, shown in its full in \eqref{eq:imp_c}, was tuned in Matlabs's SISO-tool with the goal to achieve equivalent performance as the present controller. The controller was based on a PI-controller with a notch filter to damp out higher order frequencies modes and a complex pair of zeros placed between the two resonance peaks at 38.1 and 50 Hz to gain phase margin. Finally, a lead-filter was added to increase the phase margin even further.

\begin{equation}
  \label{eq:imp_c}
  C(z) = \frac{25.33z^7 - 130.6z^6 + 301.9z^5 - 429z^4 + 424.7z^3 - 291.5z^2 + 121.8z - 22.64}{z^7 - 3.6z^6 + 5.4z^5 - 4.5z^4 + 2.2z^3 - 0.63z^2 + 0.096z - 0.0061}
\end{equation}

Figure~\ref{fig:rfdc_s_gc} shows the resulting closed loop system and the sensitivity function from output disturbance to system output. The two notches at 38.1 and 50 Hz are clearly visible in the sensitivity function. Note that the attenuation at 38.1 Hz is now slightly reduced for the \abbrIMP approach. This phenomenon is explained by Bode's integral constraints \citep{Ljung:2003} meaning that if the sensitivity function is decreased in one frequency region it will increase at another.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][Closed loop system]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/gc_imp.eps}}
  \qquad
  \subfloat[][Sensitivity function]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/s_imp.eps}}
  \caption{\label{fig:rfdc_s_gc} Bode plot of the closed loop system shown in (a) and the sensitivity function (from output disturbance to system output) shown in (b) of the \abbrIMP and the present controller. The \abbrIMP is now attenuating disturbances at 50 Hz as seen in (b).}
\end{figure}

\FloatBarrier
The \abbrIMP method was benchmarked against the present controller in all tests. As a proof of concept, a 50 Hz sinusoidal with an amplitude of \unit{0.01}{\micro\radian} was added as a disturbance and the attenuation (in the perfect case) can be seen in Figure~\ref{fig:rfdc_p_atten}. The \abbrIMP managed to attenuate 96\% of the added disturbance. The remaining 4\% can be explained by the damping that was added to the generating polynomial.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][Time domain]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/distrej.eps}}
  \qquad
  \subfloat[][\abbrFFT]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/distrej_fft.eps}}
  \caption{\label{fig:rfdc_p_atten} Closed loop time response with 50 Hz disturbance added to the output of the system. The cancellation of the 50 Hz component can both be seen in the time domain (a) and in the \abbrFFT (b). The \abbrFFT was performed after the response had settled.}
\end{figure}

For a more realistic benchmarking, disturbance data collected at 10 steps/s was added to the output of the system. The result is presented in Figure~\ref{fig:imp_realdata} where it is clear that the 50 Hz component has been damped out efficiently.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/distrej_realstep_fft.eps}
  \caption{\label{fig:imp_realdata} Cancellation of the 50 Hz component with the real acquired disturbance added to the output of the system. The \abbrFFT was performed after cancellation had settled.}
\end{figure}

\newpage
\FloatBarrier
Finally, the cancellation approach was tested for model robustness following the procedure described in Section~\ref{sec:hc}. The perturbed models used in the simulation can be seen in Figure~\ref{fig:hc_me_bode}. The attenuation of the selected frequency is presented in Figure~\ref{fig:imp_model_error1} showing that the cancellation is efficient for major model errors. One main drawback with this approach is depicted in Figure~\ref{fig:imp_model_error2} where the 130 Hz component has been amplified due to the addition of the \abbrIMP cancellation strategy.


\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:imp_model_error1}Attenuation of selected frequency]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/imp_model_error_real50.eps}}
  \qquad
  \subfloat[][\label{fig:imp_model_error2}Impact on 130 Hz component]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/imp_model_error_real.eps}}
  \caption{\label{fig:imp_model_error}  Disturbance cancellation effectiveness with model errors. The attenuation of the major frequency is shown in (a) and the unwanted attenuation of the 130 Hz component is shown in (b).}
\end{figure}

\newpage
\FloatBarrier
\subsection{Repetitive Feedforward Disturbance Cancellation}
The Repetitive Feedforward Disturbance Cancellation (\abbrRFDC) method was implemented to reject three known disturbances. Hence, three second order disturbance models as given in \eqref{eq:sinm} were augmented as shown in \eqref{eq:augmentedres}. The chosen angular frequencies for cancellation were $w_1 = 120\pi$, $w_2 = 180\pi$ and $w_3 = 400\pi$ rad/s.

\begin{subequations}
  \label{eq:augmentedres}
  \begin{alignat}{2}
    & \mathbf{A_{de}} = \diag
    \begin{pmatrix}
      \begin{bmatrix}
         0 & 1\\[0.3em]
         -w_1^2 & 0
       \end{bmatrix}  &
       \begin{bmatrix}
          0 & 1\\[0.3em]
          -w_2^2 & 0
        \end{bmatrix} &
        \begin{bmatrix}
          0 & 1\\[0.3em]
          -w_3^2 & 0
        \end{bmatrix} \\
      \end{pmatrix} \\
    & \mathbf{C_{de}} =
        \begin{bmatrix}
            1 & 0 & 1 & 0 & 1 & 0 \\
        \end{bmatrix}
  \end{alignat}
\end{subequations}

These equations where augmented according to \eqref{eq:augumented} with the discrete time system matrices which can be seen in its full form in Appendix~\ref{app:rfdc}. The observer was implemented in state space form, with the following equations.

\begin{subequations}
\label{eq:augmented}
  \begin{alignat}{2}
    & \mathbf{A_{obs}} = \mathbf{A - KC} \\
    & \mathbf{B_{obs}} = \mathbf{[B, K]}^T \\
    & \mathbf{C_{obs}} = \diag(\mathbf{C_{zs}, C_{zd}, C_{zd}, C_{zd}}) \\
    & \mathbf{D_{obs}} = \zeros(4,2)
  \end{alignat}
\end{subequations}


The observer gain $\mathbf{K}$ was calculated using Kalman theory (\texttt{dlqe} in Matlab), with a high measurement ($\mathbf{R}$) to process noise ($\mathbf{Q}$) ratio, trusting in the predefined model. The values provided to the \texttt{dlqe} function are listed in \ref{tab:kalman}.

\begin{table}[h!]
  \centering
  \begin{tabular}{| l | l |}
    \hline
    Parameter & Value \\ \hline
    $R$ & $1$ \\
    $Q$ & $10^{-5}$ \\
    $G$ & $[1, 0, 0, 0, 0, 0, 10, 0, 8, 0, 70, 0]^T$ \\
    \hline
  \end{tabular}
  \caption{\label{tab:kalman} Parameters used for calculating the observer gain.}
\end{table}

The \abbrRFDC method was benchmarked against the present controller in all tests. As a proof of concept, three sinusoidal disturbances with frequencies $w_1$, $w_2$ and $w_3$ were added to the output of the system. Even though all of them were observed only $w_3$ was used to cancel out the 200 Hz component to begin with. The result is shown in Figure~\ref{fig:1_dist_both}, where it is clear that the 200 Hz disturbance is perfectly canceled by the feedforward algorithm. Since 200 Hz is a multiple of the sampling frequency $F_s$ = 2000 Hz, one period is sufficient to capture a full number of periods within the switching times. The switch was set to turn on (load one period) at $t_{on} = 2$ s and to turn off at $t_{off} = 2+1/200$ s, which was the time when all observed states had converged.

To prove the concept for multiple harmonic cancellation, all three of the estimated disturbances were added and subtracted from the input. To capture an even number of cycles, the switching times for the 60 Hz an 90 Hz were set to [$t_{on} = 2$ s, $t_{off} = 2+6/60$ s] and [$t_{on} = 2$ s, $t_{off} = 2+9/90$ s], respectively.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:1_dist} Time domain]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/1_dist.eps}}
  \qquad
  \subfloat[][\label{fig:1_dist_fft} \abbrFFT]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/1_dist_fft.eps}}
  \caption{\label{fig:1_dist_both} Closed loop response with a 60, 90 and a 200 Hz disturbance added to the output. The cancellation of the 200 Hz component can be seen in the time domain in (a). The \abbrFFT in (b) is performed on (a) after t = 2.5 s.}
\end{figure}

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:3_dist} Time domain]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/3_dist.eps}}
  \qquad
  \subfloat[][\label{fig:3_dist_fft} \abbrFFT]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/3_dist_fft.eps}}
  \caption{\label{fig:3_dist_both} Multiple harmonic cancellation with disturbances added to the output. The cancellation of the 60, 90 and the 200 Hz component can be seen in the time domain in (a). The \abbrFFT in (b) is performed on (a) after $t=$ 2.5 s.}
\end{figure}

The result is presented in Figure~\ref{fig:3_dist_both}, which also illustrates a perfect cancellation. Note that the \abbrFFT analysis is performed on data from $t$=2.5 to $t$=5 s, i.e. at the time after the response from the feedforward cancellation had settled.

For a more realistic benchmarking, disturbance data collected at 10 steps/s was added to the output of the system. $w_1$, $w_2$ and $w_3$ are all major components of the acquired disturbance so the observer model was kept the same as before. The result presented in linear scale is shown in Figure~\ref{fig:fft_linear} where the modeled frequencies have been damped out efficiently. The gain of the 60Hz component for instance, is with the \abbrRFDC reduced by approximately 90\% of its original amplitude.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/3real_dist_fft.eps}
  \caption{\label{fig:fft_linear} Multiple harmonic cancellation with real acquired disturbances added to the output of the system. The figure shows the \abbrFFT with and without the \abbrRFDC active. When it is active, it attenuates the 60, 90 and the 200 Hz component efficiently. The \abbrFFT was performed after the cancellation had settled.}
\end{figure}

As seen in Figure~\ref{fig:fft_linear}, the attenuation of the 200Hz is far from perfect. This is due to the higher noise level that now is present with the more realistic disturbance signal. A lower gain would reduce the noise in the observed disturbance, but would also lead to a longer convergence time. Figure~\ref{fig:ph_lowgain} shows the \abbrFFT of the observed disturbance with a low gain and a settling time longer than 5 seconds. Figure~\ref{fig:ph_highgain} shows a less clean representation of the disturbance, achieved with a higher gain and a shorter settling time around 3 seconds.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][Time domain]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/model_conv.eps}}
  \qquad
  \subfloat[][\abbrFFT]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/model_conv_fft.eps}}
  \caption{\label{fig:ph_lowgain} Observer convergence of the 200Hz harmonic with low gain, $G = [1, 0, 0, 0, 0, 0, 10, 0, 8, 0, 10, 0]^T$. The \abbrFFT of the time domain convergence (a) is presented in (b) which shows a good model of the 200 Hz harmonic.}
\end{figure}

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][Time domain]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/model_conv_w.eps}}
  \qquad
  \subfloat[][\abbrFFT]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/model_conv_fft_w.eps}}
  \caption{\label{fig:ph_highgain} Observer convergence of the 200Hz harmonic with high gain, $G = [1, 0, 0, 0, 0, 0, 10, 0, 8, 0, 70, 0]^T$. The \abbrFFT of the time domain convergence (a) is presented in (b) which shows a less good model of the 200 Hz harmonic with a lot of other modeled frequency components in the region of 200 Hz.}
\end{figure}

\FloatBarrier
An even higher gain would lead to more noise added to the model and a reduction in cancellation performance as illustrated in Figure~\ref{fig:convergence}. The figure shows that a shorter convergence time implies a reduction in cancellation performance. The figures show the cancellation of the 200Hz component with a convergence time of 2s in (a) achieved with a gain of 70 as before and a convergence time of 1s in (b) achieved with a gain of 140.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][Converged within 2s]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/converge70.eps}}
  \qquad
  \subfloat[][Converged within 1s]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/converge140.eps}}
  \caption{\label{fig:convergence} Cancellation effectiveness of the 200 Hz component with different converging times. The cancellation is more effective with a slower state convergence. The cancellation effectiveness with a state convergence of 2 s is shown in (a) and of 1 s in (b).}
\end{figure}

To overcome this issue, a bandpass filter could be added to reduce the noise level of the model and thereby enabling quicker convergence. The bandpass filter stated in \eqref{eq:bandpass} was used in the simulations with $\omega=400\pi$, $k=1/100$, $\xi_a=1$ and $\xi_b=0.01$, which has zero phase shift for signals entering at 200Hz, but shifts all other frequencies. Tests were performed with this filter but without any increase in disturbance cancellation performance.

To benchmark the sensitivity to model errors, a similar simulation as in Section~\ref{sec:hc} was performed on the \abbrRFDC method. The perturbed models used in the simulation can be seen in Figure~\ref{fig:hc_me_bode}. The attenuation of the selected frequency is shown in Figure~\ref{fig:rfdc_model_error1} showing that the cancellation is efficient with low model errors, but amplifies the component if the error is too large (\abbrRFDC - 43.4 Hz in figure). Figure~\ref{fig:rfdc_model_error2} illustrates that the \abbrRFDC is not amplifying other major frequencies components by showing one example e.g. the 130 Hz component.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:rfdc_model_error1} Attenuation of selected frequency]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/rfdc_model_error_real60.eps}}
  \qquad
  \subfloat[][\label{fig:rfdc_model_error2} Impact on 130Hz component]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/rfdc_model_error_real.eps}}
  \caption{\label{fig:rfdc_model_error} Disturbance cancellation effectiveness with model errors. The attenuation of the major frequency is shown in (a) and the unwanted attenuation of the 130 Hz component is shown in (b).}
\end{figure}

\newpage~\newpage
\FloatBarrier
\section{Comparison}\label{sec:comparison}
This section compares and summarizes the different control methodologies. The \abbrIRC, \abbrMRACPE and the present controller are compared separately from the disturbance cancellation methodologies (\abbrFDC, \abbrRFDC and \abbrIMP). Table~\ref{tab:comp} and \ref{tab:comp_h} summarizes comparable results presented in previous sections. Key values from the graphs have been collected to give the reader an overview of the achieved performance for each control approach.

In Table~\ref{tab:comp}, the closed-loop bandwidth is presented for each approach, where "-" means that a theoretical bandwidth is missing for the \abbrMRACPE. The tracking error (row 3-7) is presented as the standard deviation of the difference between reference and output signal, acquired after each approach has settled. The tracking error with model errors being present is shown in row 4-7. Here, infinite tracking error means that the system is unstable. First resonance peak frequencies are selected to put the system on the border to instability. Row 7 presents the disturbance rejection with a disturbance added to the system output, measured in settling time from the time when the disturbance was added.

\begin{table}[h!]
  \centering
  \begin{tabular}{| l | P{3.4cm} | P{2.2cm} | P{2.2cm} | P{2.8cm} |}
    \hline
    \bf{No} & \bf{Aspect}  & \bf{Present} & \bf{\abbrIRC} & \bf{\abbrMRACPE} \\ \hline
    1 & Closed-loop Bandwidth [Hz] & 9.7 & 73.3 & -\\ \hline
    2 & Gain/Phase margin [dB / $^{\circ}$] & 14.4/66.2 & 13.1/49.4 & -\\ \hline
    3 & Tracking error, periodic input $\sigma$-[mrads] & $0.29$ & $0.03$ & $0.11$\\ \hline
    4 & Tracking error with model errors (model's 1st resonance at 22.0Hz), $\sigma$-[mrads] & $\infty$ & 0.03 & 0.21\\ \hline
    5 & Tracking error with model errors (model's 1st resonance at 67.2Hz), $\sigma$-[mrads] & $\infty$ & 0.03 & 0.11\\ \hline
    6 & Tracking error with model errors (model's 1st resonance at 17.6Hz), $\sigma$-[mrads] & $\infty$ & $\infty$ & 0.47\\ \hline
    7 & Tracking error with model errors (model's 1st resonance at 77.7Hz), $\sigma$-[mrads] & $\infty$ & $\infty$ & 0.11\\ \hline
    8 & Output pulse disturbance rejection, settling time (1\%) [ms] & 8 & 25 & 260\\ \hline
    9 & Input/Output noise disturbance rejection, $\sigma$-[\unit{\micro\radian}] & $0.68 $/$1.43$ & $0.45$/$1.46$ & $1.95$/$1.41$\\ \hline
    10 & Stability issues & Unstable with high model errors & Unstable with high model errors, but better than present & Good adaption even with model errors, but tuning for quicker adaption easily leads to instability.  Stability only proven in continuous time. \\ \hline
    11 & Design and implementation considerations & Straight- forward technique, allowing for basic stability analysis & Same as present & Hard to tune. High computational burden for higher order models.\\ \hline
  \end{tabular}
  \caption{\label{tab:comp} Key parameters for the \abbrIRC, the \abbrMRACPE and the present control approach.}
\end{table}

\FloatBarrier
In Table~\ref{tab:comp_h}, the cancellation effectiveness is measured as attenuation of the resonance peak with respect to the present approach. In row 3 and 4, the attenuation is measured with respect to the present controller that also includes the perturbed model written within the parentheses.

\begin{table}[h!]
  \centering
  \begin{tabular}{| l | P{3.7cm} | P{2.2cm} | P{2.2cm} | P{2.2cm} |}
    \hline
      \bf{No} & \bf{Aspect} & \bf{\abbrFDC} & \bf{\abbrRFDC} & \bf{\abbrIMP} \\ \hline
    1 & Affecting closed loop system & No & No & Yes\\ \hline
    2 & Cancellation effectiveness of major frequency, attenuation-[\%]                & 64.6 & 88.4 & 83.3\\ \hline
    3 & Cancellation with model errors (model's 1st resonance at 28.2Hz), attenuation-[\%] & 40.5 & 26.6 & 73.5\\ \hline
    4 & Cancellation with model errors (model's 1st resonance at 43.4Hz), attenuation-[\%] & 57.7 & 5.0 & 83.4\\ \hline
    5 & Implementation considerations & Requires high order model, computational demanding. & Requires observer, computational demanding. Can be used as add-on.& Controller must be retuned when selecting a new frequency. \\ \hline
  \end{tabular}
  \caption{\label{tab:comp_h} Key parameters for the harmonic cancellation methodologies.}
\end{table}

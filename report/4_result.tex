% !TEX root = main.tex
\chapter{Results}\label{cha:result}
This section describes the results considering performance, robustness and stability with respect to the different control approaches. All approaches will first be benchmarked with the present control approach and presented individually in the following subsections. A comparison between all approaches is presented in the end of this chapter.

\section{Benchmark tests}
Each of the control approaches have been evaluated with respect to robustness to model errors, disturbance rejection, closed loop bandwidth and response to step, ramp and sinusoidal input, all summarized below. The prospective challenges, described in \ref{sec:prospectiveChallanges} shall be kept in mind while reading the results. Since the required ramp rates are relatively low, the disturbance rejection and the robustness to model errors are more of interest when evaluating each method.

\begin{itemize}
\item {\bf Step, ramp and periodical tracking} - A step, ramp and periodic input is applied on the input to benchmark the tracking capability of the controller.
\item {\bf Disturbance rejection} - Modified step responses with impulses added to the input and measurement signal to benchmark how sensitive the system is to system disturbances.
\item {\bf Robustness to model errors} - During operation with a periodic input signal, the dynamical model is changed and the output is studied to characterize the robustness to model errors. This test is of importance since this is exactly what happens when the linear stage moves the rotational stage further out.
\end{itemize}

\section{Simulation Results}
For the comparison with the present control approach, all evaluated controllers were discretized with a sampling frequency of 2kHz. A normalized version of the high order system in \eqref{eq:tf} was used to model the rotational stage linear dynamics. The nonlinear dynamics, creep and hysteresis, were neglected in the simulations, assuming perfect inverse hysteresis cancellation and a sufficient closed loop to compensate for the creep effect. All simulations were performed in Matlab and Simulink.

\subsection{Model Reference Adaptive Control}
Even though the rotational stage has been modeled by \eqref{eq:tf}, a second order model approximating the higher order system was used in the adaptive control laws to keep the computational burden low. The discretized reference model can be seen in \eqref{eq:sys_gm} and all parameters and tuning variables is summarized in Table~\ref{tab:adaptive_param}. The controller is tuned to be robust to input disturbances and model changes. The set of parameter presented in Table~\ref{tab:adaptive_param} is not an optimal set but a decent set of parameters that maintains stability for step sizes below 20mrad.

\begin{equation}
  \label{eq:sys_gm}
  G_m(z) = \frac{7.9z + 6.7}{1313z^{2} - 2095z + 796.4}
\end{equation}

\begin{table}[h!]
  \centering
  \begin{tabular}{| l | l |}
    \hline
    Parameter & Value \\ \hline
    $T_s$ & $5 \times 10^{-4}$ \\
    $\alpha_0$ & $5.7 \times 10^{4}$ \\
    $\alpha_1$ & $7.2$ \\
    $\beta_0$ & $7.5 \times 10^{7}$ \\
    $a_0$ & $5.7 \times 10^{4}$ \\
    $a_1$ & $1 \times 10^{3}$ \\
    $b_0$ & $7.5 \times 10^{7}$ \\
    $\eta_0$ & $3 \times 10^{-2}$ \\
    $\eta_1$ & $1 \times 10^{-1}$ \\
    $\eta_2$ & $1 \times 10^{-10}$ \\
    $\eta_3$ & $1 \times 10^{-17}$ \\
    $\epsilon$ & $1 \times 10^{-8}$ \\
    $Q$ & $diag(1 \times 10^{10}, 1 \times 10^{-3})$\\
    \hline
  \end{tabular}
  \caption{\label{tab:adaptive_param} Parameters of the system model and the tuned adaptive controller.}
\end{table}

Figure~\ref{fig:step_adaptive} shows the step response to different step sizes. Here it is clear that the system becomes unstable if the step size $\geq$ \unit{26}{\milli\radian}. The controller has been tuned to handle the maximum step size, i.e the rotational range of \unit{20}{\milli\radian}, which results in a longer rise time for the smaller step sizes. Note that the responses are produced with initial values $k_i = 0$, if the initial values would be set to the values that $k_i$ settles to, a faster step response could be expected. This can be seen in Figure~\ref{fig:periodic_resp} where the controller performs better for the second period.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/stepresponse.eps}
  \caption{\label{fig:step_adaptive} Step responses to step sizes of 10, 15, 20 and 26 mrad.}
\end{figure}

The adaptation process of the control parameters $k_i$, for a step response resulting from a 20mrad step, can be seen in Figure~\ref{fig:adapt_process}. All of the coefficients have converged within 1 second.

\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{fig/matlab/k.eps}
  \caption{\label{fig:adapt_process} Adaptation process of control parameters $k_i$ with a 20 mrad step.}
\end{figure}

To illustrate the adaptation process better, a periodic response is depicted in Figure~\ref{fig:periodic_resp}, here it is clear that after the adaptation process is finished the controller performs better for the second and third period. One can see that the adaptation process is slower for the periodic response corresponding to the amplitude of \unit{10}{\milli\radian}, hence the lower the step, the longer the adaptation time. The present controller performs well for all amplitudes.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/periodicresponse.eps}
  \caption{\label{fig:periodic_resp} Periodic responses for the adaptive and present controller with amplitudes of 10, 15, 20 mrad.}
\end{figure}

The tracking error corresponding to the \emph{Adaptive 20mrad} and \emph{Present 20mrad} in Figure~\ref{fig:periodic_resp} can be seen in Figure~\ref{fig:adapt_trackingerror}. The adaptive controller performs better than the present controller after the adaptation process has finished.
\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/trackingerror.eps}
  \caption{\label{fig:adapt_trackingerror} Tracking error (difference between reference and output) for the periodic response from an input signal with an amplitude of 20 mrad.}
\end{figure}

A periodic response with model parameter drift is presented in Figure~\ref{fig:modeldrift}. It shows how the adaptive controller manages to adapt to the change in the system dynamics, while the present controller fails to do so, resulting in an unstable system. The change of the model was performed over 2 seconds, resulting in a movement of the first resonance peak, from 38 Hz to 66 Hz in frequency and from 30.1 dB to 23.5 dB in magnitude. Note that the change of the model is relatively big and for a smaller movement of the resonance peak, the present controller could still be sufficient as illustrated in Figure~\ref{fig:modelerror}.
\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:modeldriftresponse}Periodic response with model parameter drift.]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/driftofmodelparameterover2s.eps}}
  \qquad
  \subfloat[][\label{fig:modeldriftbode}Original model (G) and the resulting model after drift ($G_{mod}$).]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 0.7cm 0cm, clip=true]{fig/matlab/bode_drift_pole.eps}}
  \caption{\label{fig:modeldrift} Shows the robustness to model changes over time. The model error is increased linearly from $t=7s$ to $t=9s$. The resulting responses is shown in (a) with the model change in (b).}
\end{figure}

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:modelerrorresponse}Periodic response with model parameter drift.]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/modelerrorperiodic.eps}}
  \qquad
  \subfloat[][\label{fig:modelerrorbode}Original model (G) and the resulting model after drift ($G_{mod}$).]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 0.7cm 0cm, clip=true]{fig/matlab/bode_modelerror_pole.eps}}
  \caption{\label{fig:modelerror}Shows the robustness to model changes over time. The model error is increased linearly from $t=7s$ to $t=9s$. The resulting responses is shown in (a) with the model change in (b).}
\end{figure}

In the case in Figure~\ref{fig:modelerror} the resonance peak is only moved to 45.5 Hz and the present controller is sufficient to suppresses the disturbance. It even does it more efficiently than the adaptive controller.

Figure~\ref{fig:distrejection} and \ref{fig:distmeasrejection} shows the disturbance rejection capability to a disturbance on the input and output, receptively. In Figure~\ref{fig:distrejection} a small impulse was added to the input to see if the controllers would attenuate it sufficiently. The adaptive controller performed worse than the present controller both with and without pre-filter. The present controller managed to attenuated the highest peak of the impulse by 3 times more than the adaptive with pre-filter and 5 times more than the adaptive without pre-filter. The settling time was also approximately 12 times worse for the adaptive controllers. The pre-filter used with the adaptive controller is the one presented in \eqref{eq:lead}. Hence it is not optimal for the adaptive controller since its closed loop system differs from the present controller. However, since the closed loop bode plot for the adaptive controller is hard to attain, the filter in \eqref{eq:lead} provides a quick way to see that a better attenuation can be achieved with a properly designed pre-filter. In Figure~\ref{fig:distmeasrejection} the small input was instead added to the measured signal. Even in this case the present controller was superior, attenuating the highest peak of the impulse by 3 times more than the adaptive controller.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:dist}Step response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/distrejection.eps}}
  \qquad
  \subfloat[][\label{fig:distzoom}Zoom in on disturbance]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/distrejection_zoom.eps}}
  \caption{\label{fig:distrejection} Shows how well the controller attenuates a disturbance impulse (amplitude of $5.1 \times 10^{-3}$) added to the input signal at $t=3s$. The whole step response is shown in (a) with a zoom in on the disturbance in (b).}
\end{figure}
\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:distmeas}Step response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/distrejection_meas.eps}}
  \qquad
  \subfloat[][\label{fig:distmeaszoom}Zoom in on disturbance]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0.8cm, clip=true]{fig/matlab/distrejection_meas_zoom.eps}}
  \caption{\label{fig:distmeasrejection} Disturbance rejection to impulses (amplitude of $5.1 \times 10^{-3}$) added to the measured signal at $t=3s$. The step response is shown in (a)  with a zoom in on the disturbance in (b).}
\end{figure}

\newpage
\subsection{Integral Resonance Control}
The \abbrIRC design procedure presented in \ref{sec:irc} was carried out in continues time, but each block in the scheme was individually discretized for the sake of comparison with the present controller. The continues time system of \eqref{eq:tf} consist of a system with 7 poles and 6 zeros. A negative feedforward would therefore introduce another zero and depending on the gain placing the zeros in a desired position. As seen in the pole-zero plot comparison in Figure~\ref{fig:negfeedpzmap}, a feedforward of $D_f=-1.2$ was sufficient to introduce one zero and place it and its complex conjugate below the first resonance frequency. This and the zero-pole interlacing for the higher order modes can be seen in Figure~\ref{fig:pzafter}, where the zoom-in shows the complex conjugate zeros below the first resonance mode.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:pzbefore}Origianl system]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/pzbefore.eps}}
  \qquad
  \subfloat[][\label{fig:pzafter}After feedforward]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/pzafter.eps}}
  \caption{\label{fig:negfeedpzmap} Comparison of pole-zero plot before and after adding the negative feedforward. After adding the feedforward to the system which poles and zeros are shown in (a) , the zeros and poles are interlacing as seen in (b).}
\end{figure}

The corresponding bode plot can be seen in Figure~\ref{fig:bodeafterfeedf}, showing the complex conjugate pair of zeros as a dip before the first resonance peak.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/bodeafterfeedf.eps}
  \caption{\label{fig:bodeafterfeedf} Bode plot of the system before and after the addition of the negative feedforward.}
\end{figure}

The integral controller $C=\frac{-k}{s}$ was added according to Section~\ref{sec:irc} and a gain of $k=314$ was found to maximize the damping, by using the root locus technique.
The open and closed loop system of the \abbrIRC damping loop depicted in Figure~\ref{fig:irc} is shown in Figure~\ref{fig:bodedamped}. It is clear that the integral controller damps out the first resonance peak efficiently in closed loop.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/bodedamped.eps}
  \caption{\label{fig:bodedamped} Open and closed loop of the IRC damping loop.}
\end{figure}

Finally, the damped system was enclosed in an outer loop with a second controller $C_1$ for reference tracking capability. $C_1$ was designed to be robust to model errors i.e. keep the sensitivity function $G_{dy}$, stated in \eqref{eq:Gyd}, low for the frequencies that the model changes with, (d and y in $G_{dy}$ can be found in the block scheme in Figure~\ref{fig:irc_int}). $C_1$ was designed in Matlab's  SISO-Tool and is presented in \eqref{eq:C_1}.

\begin{equation}
  \label{eq:Gyd}
  G_{yd} = \frac{1}{1 + C_2G(1 + C_1)}
\end{equation}

\begin{equation}
  \label{eq:C_1}
  C_1 = \frac{-13.54 z^5 + 40.92 z^4 - 57.47 z^3 + 55.89 z^2 - 35.87 z + 10.05}{z^5 - 1.65 z^4 + 0.80 z^3 - 0.16 z^2 + 0.014 z - 0.00042}
\end{equation}

The resulting closed loop system and the sensitivity function is shown in Figure~\ref{fig:irc_totalclosed} and \ref{fig:sensitivity_irc}, respectively. The plots show that the use of the \abbrIRC has increased the closed loop bandwidth from 11 Hz to 73 Hz, corresponding to an increase of 6.5 times the present closed loop bandwidth.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/totalclosedloop.eps}
  \caption{\label{fig:irc_totalclosed} Closed loop system of the \abbrIRC and the present approach}
\end{figure}

The \abbrIRC sensitivity function also shows that the \abbrIRC scheme attenuates model disturbances better in the low frequency range and in the region within 24-64 Hz.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/sensitivity_irc.eps}
  \caption{\label{fig:sensitivity_irc}Sensitivity function ($G_{dy}$) of the \abbrIRC and the present approach}
\end{figure}

The \abbrIRC tracking performance is shown in Figure~\ref{fig:irc_tracking}. One can conclude that the \abbrIRC approach is able to eliminate the constant ramp tracking error which the present doesn't handle, see Figure~\ref{fig:irc_periodic}. Hence the tracking error in Figure~\ref{fig:irc_tracking} is a lot lower for the \abbrIRC approach.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:irc_periodic}Periodic Response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/irc_periodic.eps}}
  \qquad
  \subfloat[][\label{fig:irc_tracking_error}Tracking error]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/irctrackingerror.eps}}
  \caption{\label{fig:irc_tracking} Periodic response of the \abbrIRC and the present controller. A zoom in on one period is shown in (a) while a the tracking error over three periods are shown in (b).}
\end{figure}

The robustness test perfromed for the adaptive controller was done for the \abbrIRC controller accordingly. Figure~\ref{fig:irc_dist_model} shows the response to minor model changes depicted in Figure~\ref{fig:modelerrorbode}. While Figure~\ref{fig:irc_dist_model_drift} shows the response corresponding to a larger drift in the model according to Figure~\ref{fig:modeldrift}. The \abbrIRC handles the model drift better than the present controller in both cases, even when the model change i major and the system with the present controller becomes unstable.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:irc_dist_model}Periodic response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/ircdistrej_pole.eps}}
  \qquad
  \subfloat[][\label{fig:irc_dist_model_drift}Periodic response with model parameter drift.]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/ircdistrej_drift.eps}}
  \caption{\label{fig:irc_dist} Shows the robustness to model changes over time. The model error is increased linearly from $t=3s$ to $t=5s$. The resulting responses is shown in (a) while the model change is presented in (b).}
\end{figure}

The \abbrIRC capability of rejecting disturbances on the input signal is shown in Figure~\ref{fig:irc_dist_input}. A pre-filter in form of a lowpass filter stated in \eqref{eq:F_irc} was designed for the \abbrIRC approach using Matlab's SISO-Tool. The effect of the pre-filter is obvious and shows that the \abbrIRC easily can be combined with a prefilter for a better attenuation of input disturbances.

\begin{equation}
  \label{eq:F_irc}
  F_{irc} = \frac{0.0012}{(z - 0.965)^2}
\end{equation}

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:irc_dist_input_step}Step response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/irc_dist_input.eps}}
  \qquad
  \subfloat[][\label{fig:irc_dist_input_zoom}Zoom in on disturbance]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/irc_dist_input_zoom.eps}}
  \caption{\label{fig:irc_dist_input} Shows how well the controller attenuates a disturbance impulse (amplitude of $5.1 \times 10^{-3}$) added to the input signal at $t=3s$. The whole step response is shown in (a) while a zoom in on the boxed area is presented in (b).}
\end{figure}

The \abbrIRC capability of rejecting disturbances on the output signal is shown in Figure~\ref{fig:irc_dist_output}. Since the impulse is added directly on the output the steps response peaks accordingly at $t=3s$. It is hard to tell from Figure~\ref{fig:irc_dist_output_zoom}, but the peak is visible for both of the control approaches. After the peak, the methods perform similarly, with a slightly higher damping and amplitude for the \abbrIRC oscillations shown in the zoom in. To further verify the controller capability of handling disturbances with various frequencies, a white noise was added to the $d$ signal shown in Figure~\ref{fig:irc_int}. The \abbrFFT was then taken on the output to verify that the result was similar to the obtained sensitivity function in Figure~\ref{fig:sensitivity_irc}. The \abbrFFT result is shown in Figure~\ref{fig:fft_sens} and indeed shows a similar result.

\begin{figure}[h!]
  \centering %crop: left bottom right top
  \subfloat[][\label{fig:irc_dist_output_step}Step response]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/distrej_meas.eps}}
  \qquad
  \subfloat[][\label{fig:irc_dist_output_zoom}Zoom in on disturbance]{
  \includegraphics[width=0.46\textwidth, trim=0cm 0cm 1cm 0cm, clip=true]{fig/matlab/distrej_meas_zoom.eps}}
  \caption{\label{fig:irc_dist_output} Shows how well the controller attenuates a disturbance impulse (amplitude of $5.1 \times 10^{-3}$) added to the measured signal at $t=3s$. The whole step response is shown in (a) while a zoom in on the boxed area is presented in (b).}
\end{figure}


\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{fig/matlab/whitenoisetest.eps}
  \caption{\label{fig:fft_sens} Sensitivity function ($G_{dy}$) of the \abbrIRC and the present approach}
\end{figure}


%
% \newpage
% \section{Experimental Results}
% \subsection{Setup}
% The experiments have been conducted on the considered rotational stage described in Section~\ref{sec:rotational_stage}. A National Instruments PXI communicates with the Collimator and the rotational stage, responsible for acquisition and control. To drive the rotational stage it outputs a voltage between [-1, 7.5] V, this is amplified by a linear amplifier with a gain of \unit{20}{\volt/\volt} resulting in a [-20, 150] V signal input on the rotational stage. The yaw angle, measured by the interferometric system is converted and sent to the PXI. The control loop is running at \unit{2}{\kilo\hertz}.
